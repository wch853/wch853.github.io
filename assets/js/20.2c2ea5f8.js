(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{223:function(_,v,a){"use strict";a.r(v);var t=a(0),e=Object(t.a)({},(function(){var _=this,v=_.$createElement,a=_._self._c||v;return a("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[a("h1",{attrs:{id:"java面试（二）：数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#java面试（二）：数据库"}},[_._v("#")]),_._v(" Java面试（二）：数据库")]),_._v(" "),a("h2",{attrs:{id:"关系型数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关系型数据库"}},[_._v("#")]),_._v(" 关系型数据库")]),_._v(" "),a("ul",[a("li",[_._v("文件系统：将数据持久化到硬盘中。")]),_._v(" "),a("li",[_._v("存储管理：对数据格式、文件分隔等进行统一管理，即把物理数据通过逻辑的形式组织和表示出来。")]),_._v(" "),a("li",[_._v("缓存管理：将读取的数据块加载到缓存中，下次读取直接从缓存中返回，避免频繁与硬盘发生 "),a("code",[_._v("I/O")]),_._v("。")]),_._v(" "),a("li",[a("code",[_._v("SQL")]),_._v(" 解析：将用户 "),a("code",[_._v("SQL")]),_._v(" 语句进行解析，进行相应的操作。")]),_._v(" "),a("li",[_._v("日志管理：记录操作日志，方便主从同步、灾难恢复等。")]),_._v(" "),a("li",[_._v("权限管理：各个用户的操作权限应该被限制。")]),_._v(" "),a("li",[_._v("容灾机制：如何恢复。")]),_._v(" "),a("li",[_._v("索引管理：")]),_._v(" "),a("li",[_._v("锁管理：")])]),_._v(" "),a("h2",{attrs:{id:"索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#索引"}},[_._v("#")]),_._v(" 索引")]),_._v(" "),a("h3",{attrs:{id:"为什么使用索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么使用索引"}},[_._v("#")]),_._v(" 为什么使用索引")]),_._v(" "),a("p",[_._v("全表扫描的方式将整张表的数据全部或分批次加载到内存中，然后对逐个块（页）进行查询。这种查询方式在数据量小的时候是比较高效的，在数据量大时则需要尽可能避免。而查询额外维护的索引文件则可以很快定位到数据所在的块（页），从而大幅提升了查询速度。")]),_._v(" "),a("h3",{attrs:{id:"什么样的信息能成为索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么样的信息能成为索引"}},[_._v("#")]),_._v(" 什么样的信息能成为索引")]),_._v(" "),a("p",[_._v("主键、唯一键和普通键等。")]),_._v(" "),a("h3",{attrs:{id:"索引的数据结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#索引的数据结构"}},[_._v("#")]),_._v(" 索引的数据结构")]),_._v(" "),a("ul",[a("li",[a("code",[_._v("BTREE")])]),_._v(" "),a("li",[a("code",[_._v("B+TREE")])])]),_._v(" "),a("h3",{attrs:{id:"稠密索引和稀疏索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#稠密索引和稀疏索引"}},[_._v("#")]),_._v(" 稠密索引和稀疏索引")]),_._v(" "),a("ul",[a("li",[a("p",[_._v("搜索码：用于在文件中查找记录的属性或属性集。")])]),_._v(" "),a("li",[a("p",[_._v("稠密索引：每个搜索码对应一个索引值，索引项包括索引值以及指向该搜索码值的第一条数据记录的指针，可以很快的定位记录。")])]),_._v(" "),a("li",[a("p",[_._v("稀疏索引：只为搜索码的某些值建立索引，索引项为关键字和主键的值。比如稀疏索引为每个数据块建立一个索引，数据块意味着内存单元连续。稀疏索引占用空间更小，修改记录所需维护的开销也小。")])])]),_._v(" "),a("h3",{attrs:{id:"慢查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#慢查"}},[_._v("#")]),_._v(" 慢查")]),_._v(" "),a("ul",[a("li",[_._v("根据慢查日志定位\n"),a("ul",[a("li",[_._v("修改 "),a("code",[_._v("slow_query_log")]),_._v(" 为 "),a("code",[_._v("on")]),_._v(" 来开启慢查日志。")]),_._v(" "),a("li",[_._v("修改 "),a("code",[_._v("slow_query_log_file")]),_._v(" 定义慢查日志文件位置，默认在 "),a("code",[_._v("data")]),_._v(" 目录下。")])])]),_._v(" "),a("li",[_._v("使用 "),a("code",[_._v("explain")]),_._v(" 等工具分析 "),a("code",[_._v("SQL")]),_._v(" "),a("ul",[a("li",[a("code",[_._v("id")]),_._v("：表示执行 "),a("code",[_._v("SQL")]),_._v(" 语句的顺序，值越大，越先被执行。")]),_._v(" "),a("li",[a("code",[_._v("select_type")]),_._v("：每个查询子句的类型。是简单查询还是包含子查询的复杂查询。")]),_._v(" "),a("li",[a("code",[_._v("type")]),_._v("：访问类型。性能 "),a("code",[_._v("ALL（全表扫描） < INDEX（遍历索引树） < RANGE（索引范围扫描） < REF（索引前缀扫描） < EQ_REF（唯一索引） < CONST（查询转常量） < SYSTEM（特殊 Const） < NULL（无需访问索引直接定位）")]),_._v(" 。")]),_._v(" "),a("li",[a("code",[_._v("possible_keys")]),_._v("：查询可能使用到的索引。")]),_._v(" "),a("li",[a("code",[_._v("key")]),_._v("：实际使用的索引。")]),_._v(" "),a("li",[a("code",[_._v("key_len")]),_._v("：索引使用的字节数，可用于计算使用的索引的长度。")]),_._v(" "),a("li",[a("code",[_._v("ref")]),_._v("：哪些列或常量被用于查找索引列上的值。")]),_._v(" "),a("li",[a("code",[_._v("row")]),_._v("：估算找到所需记录扫描的行数。")]),_._v(" "),a("li",[a("code",[_._v("Extra")]),_._v("：额外的重要信息。出现 "),a("code",[_._v("Using filesort")]),_._v(" 或 "),a("code",[_._v("Using temporary")]),_._v(" 意味着根本不能使用索引，应尽可能对查询进行优化。")])])]),_._v(" "),a("li",[_._v("修改 "),a("code",[_._v("SQL")]),_._v(" 尽量使查询走索引。")])]),_._v(" "),a("h3",{attrs:{id:"联合索引最左匹配原则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#联合索引最左匹配原则"}},[_._v("#")]),_._v(" 联合索引最左匹配原则")]),_._v(" "),a("p",[_._v("对于联合索引，数据库会一直向右匹配直到遇到范围查询（"),a("code",[_._v(">")]),_._v("、"),a("code",[_._v("<")]),_._v("、"),a("code",[_._v("between")]),_._v("、"),a("code",[_._v("like")]),_._v("）停止匹配。如建立索引为 "),a("code",[_._v("(a, b, c, d)")]),_._v("，查询条件为 "),a("code",[_._v("a = 1 and b = 2 and c > 3 and d = 4")]),_._v("，则 "),a("code",[_._v("d")]),_._v(" 匹配不到索引，而如果建立索引 "),a("code",[_._v("(a, b, d, c)")]),_._v(" 则全部可以匹配并且 "),a("code",[_._v("a、b、d")]),_._v(" 可以乱序。")]),_._v(" "),a("p",[_._v("联合索引在建立的时候，会依次对索引中的字段进行排序，也就是在前一个字段排序的基础上对下一个字段进行排序，因此第一个字段是绝对有序的，如果查询语句不从最左开始匹配，是无法使用索引的。")]),_._v(" "),a("h3",{attrs:{id:"索引不是越多越好"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#索引不是越多越好"}},[_._v("#")]),_._v(" 索引不是越多越好")]),_._v(" "),a("ul",[a("li",[_._v("表数据量小时不需要建立索引，维护索引会增加不必要的开销。")]),_._v(" "),a("li",[_._v("数据变更需要维护索引，更多索引意味着更高的维护成本。")]),_._v(" "),a("li",[_._v("更多的索引需要更多的存储空间。")])]),_._v(" "),a("h2",{attrs:{id:"锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#锁"}},[_._v("#")]),_._v(" 锁")]),_._v(" "),a("h3",{attrs:{id:"锁的分类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#锁的分类"}},[_._v("#")]),_._v(" 锁的分类")]),_._v(" "),a("ul",[a("li",[_._v("按锁的粒度划分：表级锁、行级锁、页级锁")]),_._v(" "),a("li",[_._v("按锁的级别划分：共享锁和排它锁")]),_._v(" "),a("li",[_._v("按锁的方式划分：自动锁、显示锁")]),_._v(" "),a("li",[_._v("按操作划分，可分为 "),a("code",[_._v("DML")]),_._v(" 锁、"),a("code",[_._v("DDL")]),_._v(" 锁")]),_._v(" "),a("li",[_._v("按使用方式划分，可分为乐观锁和悲观锁")])]),_._v(" "),a("h3",{attrs:{id:"共享锁与排它锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#共享锁与排它锁"}},[_._v("#")]),_._v(" 共享锁与排它锁")]),_._v(" "),a("ul",[a("li",[_._v("共享锁（"),a("code",[_._v("IS")]),_._v("）：又称读锁，可以被多个线程同时持有。")]),_._v(" "),a("li",[_._v("排它锁（"),a("code",[_._v("IX")]),_._v("）：又称写锁、独占锁，同一时刻只能被一个线程所持有。")])]),_._v(" "),a("h4",{attrs:{id:"兼容性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#兼容性"}},[_._v("#")]),_._v(" 兼容性")]),_._v(" "),a("table",[a("thead",[a("tr",[a("th",[_._v("锁类型")]),_._v(" "),a("th",[_._v("X")]),_._v(" "),a("th",[_._v("S")])])]),_._v(" "),a("tbody",[a("tr",[a("td",[_._v("X")]),_._v(" "),a("td",[_._v("冲突")]),_._v(" "),a("td",[_._v("冲突")])]),_._v(" "),a("tr",[a("td",[_._v("S")]),_._v(" "),a("td",[_._v("冲突")]),_._v(" "),a("td",[_._v("j兼容")])])])]),_._v(" "),a("h3",{attrs:{id:"mysql-引擎"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql-引擎"}},[_._v("#")]),_._v(" MySQL 引擎")]),_._v(" "),a("h4",{attrs:{id:"myisam"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#myisam"}},[_._v("#")]),_._v(" MyISAM")]),_._v(" "),a("p",[a("code",[_._v("MyISAM")]),_._v(" 默认使用表级锁，不支持行级锁。")]),_._v(" "),a("ul",[a("li",[_._v("适合频繁执行全表 "),a("code",[_._v("count")]),_._v(" 语句（变量保存，直接读取）的场景。")]),_._v(" "),a("li",[_._v("适合查询频繁，增删改频率不高的场景。")]),_._v(" "),a("li",[_._v("适合不需要使用事务的场景。")])]),_._v(" "),a("h4",{attrs:{id:"innodb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#innodb"}},[_._v("#")]),_._v(" InnoDB")]),_._v(" "),a("p",[a("code",[_._v("InnoDB")]),_._v(" 默认使用行级锁，也支持表级锁。")]),_._v(" "),a("ul",[a("li",[_._v("适合数据增删改查都很频繁的场景。")]),_._v(" "),a("li",[_._v("适合对可靠性要求比较高，要求支持事务的场景。")])]),_._v(" "),a("h3",{attrs:{id:"事务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事务"}},[_._v("#")]),_._v(" 事务")]),_._v(" "),a("h4",{attrs:{id:"acid"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#acid"}},[_._v("#")]),_._v(" ACID")]),_._v(" "),a("ul",[a("li",[a("code",[_._v("Atomic")])]),_._v(" "),a("li",[a("code",[_._v("Consistency")])]),_._v(" "),a("li",[a("code",[_._v("Isolation")])]),_._v(" "),a("li",[a("code",[_._v("Durability")])])]),_._v(" "),a("h4",{attrs:{id:"当前读和快照读"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#当前读和快照读"}},[_._v("#")]),_._v(" 当前读和快照读")]),_._v(" "),a("ul",[a("li",[_._v("当前读：读取的是数据的最新版本，并且返回的记录都会加上锁，保证其它事务不会修改当前记录。")]),_._v(" "),a("li",[_._v("快照读：读取的是数据的可见版本（可能是历史数据），不用加锁。")])]),_._v(" "),a("h4",{attrs:{id:"next-key-锁（行锁-gap锁）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#next-key-锁（行锁-gap锁）"}},[_._v("#")]),_._v(" next-key 锁（行锁 + Gap锁）")]),_._v(" "),a("h5",{attrs:{id:"gap-锁（间隙锁）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gap-锁（间隙锁）"}},[_._v("#")]),_._v(" Gap 锁（间隙锁）")]),_._v(" "),a("p",[_._v("对索引间可插入数据的间隙加锁，避免出现幻读。"),a("code",[_._v("Gap")]),_._v(" 锁会用在非唯一索引或不走索引的当前读中。")]),_._v(" "),a("h5",{attrs:{id:"使用条件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用条件"}},[_._v("#")]),_._v(" 使用条件")]),_._v(" "),a("ul",[a("li",[_._v("如果 "),a("code",[_._v("where")]),_._v(" 条件全部命中则只会使用行锁。")]),_._v(" "),a("li",[_._v("如果 "),a("code",[_._v("where")]),_._v(" 条件部分命中或全部不命中，则会加 "),a("code",[_._v("Gap")]),_._v(" 锁。")])])])}),[],!1,null,null,null);v.default=e.exports}}]);