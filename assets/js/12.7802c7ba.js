(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{218:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"elasticsearch（一）：概念与基本api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch（一）：概念与基本api"}},[t._v("#")]),t._v(" Elasticsearch（一）：概念与基本API")]),t._v(" "),a("h2",{attrs:{id:"安装-elasticsearch"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-elasticsearch"}},[t._v("#")]),t._v(" 安装 Elasticsearch")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建 es 网络")]),t._v("\ndocker network create es\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动单点 es")]),t._v("\ndocker run -d --name elasticsearch --net es -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9200")]),t._v(":9200 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9300")]),t._v(":9300 -e "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"discovery.type=single-node"')]),t._v(" --restart"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("always elasticsearch:7.4.2\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动 kibana")]),t._v("\ndocker run -d --name kibana --net es -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5601")]),t._v(":5601 --restart"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("always kibana:7.4.2\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动 es 集群监控工具 cerebro")]),t._v("\ndocker run -d --name cerebro -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9000")]),t._v(":9000 --restart"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("always lmenezes/cerebro\n")])])]),a("h2",{attrs:{id:"常用-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用-api"}},[t._v("#")]),t._v(" 常用 API")]),t._v(" "),a("h3",{attrs:{id:"index"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#index"}},[t._v("#")]),t._v(" index")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建索引")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PUT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("test\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 查看已有索引")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("GET")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("_cat"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("indices\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 删除索引")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DELETE")]),t._v(" test\n")])])]),a("h3",{attrs:{id:"document"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#document"}},[t._v("#")]),t._v(" Document")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 指定 id 创建文档")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PUT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("_doc"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"username"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wch"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 不指定 id 创建文档")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("POST")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("_doc\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"username"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wch"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 查询指定文档")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("GET")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("_doc"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 查询所有文档")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("GET")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("_search\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"query"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"term"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"value"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 删除指定文档")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DELETE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("_doc"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 批量执行")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("POST")]),t._v(" _bulk\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"index"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_index"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\t\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"username"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"123"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 指定索引新增")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"delete"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_index"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wAKA5G4B6QyCVohhC0Yn"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 指定索引删除")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"update"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_index"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"doc"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"username"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wch1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 指定索引更新")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 指定 index、id 批量查询")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("GET")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("_mget\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"docs"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_index"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_index"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"倒排索引与分词"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#倒排索引与分词"}},[t._v("#")]),t._v(" 倒排索引与分词")]),t._v(" "),a("h3",{attrs:{id:"倒排索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#倒排索引"}},[t._v("#")]),t._v(" 倒排索引")]),t._v(" "),a("h4",{attrs:{id:"倒排索引与正排索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#倒排索引与正排索引"}},[t._v("#")]),t._v(" 倒排索引与正排索引")]),t._v(" "),a("ul",[a("li",[t._v("正排索引：从文档 "),a("code",[t._v("id")]),t._v(" 到文档内容单词的关联关系。")]),t._v(" "),a("li",[t._v("倒排索引：从单词到文档 "),a("code",[t._v("id")]),t._v(" 的关联关系。")])]),t._v(" "),a("h4",{attrs:{id:"倒排索引组成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#倒排索引组成"}},[t._v("#")]),t._v(" 倒排索引组成")]),t._v(" "),a("ul",[a("li",[t._v("单词词典：记录文档单词和单词到倒排列表的关联信息。")]),t._v(" "),a("li",[t._v("倒排列表：记录了单词对应的文档集合，由倒排索引项组成。倒排索引项包括文档 "),a("code",[t._v("id")]),t._v("、单词词频、单词位置、单词偏移。")])]),t._v(" "),a("h3",{attrs:{id:"分词"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分词"}},[t._v("#")]),t._v(" 分词")]),t._v(" "),a("p",[t._v("分词是指将文本转换成一系列单词的过程，也可以叫做文本分析。")]),t._v(" "),a("h4",{attrs:{id:"分词器组成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分词器组成"}},[t._v("#")]),t._v(" 分词器组成")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("Character Filters")]),t._v("：针对原始文本做预处理，如去增加、删除、替换字符等。")]),t._v(" "),a("li",[a("code",[t._v("Tokenizer")]),t._v("：将原始文本按照一定规则切分为单词。")]),t._v(" "),a("li",[a("code",[t._v("Token Filters")]),t._v("：针对切分单词再加工，如转小写、删除或新增等处理。")])]),t._v(" "),a("h4",{attrs:{id:"验证分词"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#验证分词"}},[t._v("#")]),t._v(" 验证分词")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 指定分词器验证分词")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("GET")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("_analyze\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"analyzer"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"standard"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"text"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello World"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 指定索引、文档字段验证分词")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("GET")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("_analyze\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"field"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"username"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"text"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello World"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h4",{attrs:{id:"自带分词器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自带分词器"}},[t._v("#")]),t._v(" 自带分词器")]),t._v(" "),a("h5",{attrs:{id:"standard"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#standard"}},[t._v("#")]),t._v(" standard")]),t._v(" "),a("p",[t._v("默认分词器，按词切分，支持多语言，小写处理。")]),t._v(" "),a("h5",{attrs:{id:"simple"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#simple"}},[t._v("#")]),t._v(" simple")]),t._v(" "),a("p",[t._v("按照非字母切分，小写处理。")]),t._v(" "),a("h5",{attrs:{id:"whitespace"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#whitespace"}},[t._v("#")]),t._v(" whitespace")]),t._v(" "),a("p",[t._v("按空格切分。")]),t._v(" "),a("h5",{attrs:{id:"stop"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#stop"}},[t._v("#")]),t._v(" stop")]),t._v(" "),a("p",[t._v("按照非字母切分，小写处理，去除停用词。")]),t._v(" "),a("h5",{attrs:{id:"keyword"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#keyword"}},[t._v("#")]),t._v(" keyword")]),t._v(" "),a("p",[t._v("不分词，直接作为一个单词输出。")]),t._v(" "),a("h5",{attrs:{id:"pattern"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pattern"}},[t._v("#")]),t._v(" pattern")]),t._v(" "),a("p",[t._v("通过正则表达式（默认为 "),a("code",[t._v("\\W+")]),t._v("）切分，小写处理。")]),t._v(" "),a("h2",{attrs:{id:"mapping"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mapping"}},[t._v("#")]),t._v(" mapping")]),t._v(" "),a("p",[a("code",[t._v("mapping")]),t._v(" 类似数据库中的表结构定义，主要作用为：")]),t._v(" "),a("ul",[a("li",[t._v("定义索引字段名")]),t._v(" "),a("li",[t._v("定义索引字段类型")]),t._v(" "),a("li",[t._v("定义倒排索引相关配置，如是否索引、索引配置等")])]),t._v(" "),a("p",[a("code",[t._v("mapping")]),t._v(" 中的字段类型禁止直接修改（"),a("code",[t._v("lucene")]),t._v(" 实现的倒排索引生成后不允许修改），如果修改需要建立新的索引，然后做 "),a("code",[t._v("reindex")]),t._v(" 操作。")]),t._v(" "),a("h3",{attrs:{id:"mapping-配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mapping-配置"}},[t._v("#")]),t._v(" mapping 配置")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PUT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("test\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mappings"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dynamic"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"properties"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"type"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"text"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fields"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pinyin"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"type"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"keyword"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"analyzer"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pinyin"')]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"age"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"type"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"integer"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"null_value"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"desc"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"type"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"keyword"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"index"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"address"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"type"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"text"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"index_options"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"positions"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h4",{attrs:{id:"dynamic"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dynamic"}},[t._v("#")]),t._v(" dynamic")]),t._v(" "),a("p",[a("code",[t._v("mapping")]),t._v(" 中的 "),a("code",[t._v("dynamic")]),t._v(" 参数用来控制字段的新增：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("true")]),t._v("：默认配置，允许字段新增。")]),t._v(" "),a("li",[a("code",[t._v("false")]),t._v("：不允许字段新增字段，但是文档可以正常写入，但无法对字段进行查询等操作。")]),t._v(" "),a("li",[a("code",[t._v("strict")]),t._v("：文档不允许写入新字段，强行写入会抛出异常。")])]),t._v(" "),a("h4",{attrs:{id:"properties"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#properties"}},[t._v("#")]),t._v(" properties")]),t._v(" "),a("p",[a("code",[t._v("properties")]),t._v(" 参数用来定义各个具体的字段。")]),t._v(" "),a("h4",{attrs:{id:"index-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#index-2"}},[t._v("#")]),t._v(" index")]),t._v(" "),a("p",[a("code",[t._v("index")]),t._v(" 参数用于控制字段是否索引。")]),t._v(" "),a("h4",{attrs:{id:"index-options"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#index-options"}},[t._v("#")]),t._v(" index_options")]),t._v(" "),a("p",[a("code",[t._v("index_options")]),t._v(" 用于控制倒排索引记录内容：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("docs")]),t._v("：仅记录 "),a("code",[t._v("doc id")]),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("freqs")]),t._v("：记录 "),a("code",[t._v("doc id")]),t._v(" 和 "),a("code",[t._v("term frequencies")]),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("positions")]),t._v("：记录 "),a("code",[t._v("doc id")]),t._v("、"),a("code",[t._v("term frequencies")]),t._v(" 和 "),a("code",[t._v("term position")]),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("offsets")]),t._v("：记录 "),a("code",[t._v("doc id")]),t._v("、"),a("code",[t._v("term frequencies")]),t._v("、"),a("code",[t._v("term position")]),t._v(" 和 "),a("code",[t._v("character offsets")]),t._v("。")])]),t._v(" "),a("p",[a("code",[t._v("text")]),t._v(" 类型默认为 "),a("code",[t._v("positions")]),t._v("，其它默认为 "),a("code",[t._v("docs")]),t._v("。选择记录的内容越多，占用空间越大。")]),t._v(" "),a("h4",{attrs:{id:"null-value"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#null-value"}},[t._v("#")]),t._v(" null_value")]),t._v(" "),a("p",[a("code",[t._v("null_value")]),t._v(" 字段用于指定字段为 "),a("code",[t._v("null")]),t._v(" 时的处理策略，默认 "),a("code",[t._v("es")]),t._v(" 会忽略该字段。可以通过该值来设定字段的默认值。")]),t._v(" "),a("h4",{attrs:{id:"multi-fields"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#multi-fields"}},[t._v("#")]),t._v(" multi-fields")]),t._v(" "),a("p",[a("code",[t._v("es")]),t._v(" 允许对一个字段采用不同的配置，只需要在字段配置中增加 "),a("code",[t._v("fields")]),t._v(" 参数，成为当前字段的子字段。")]),t._v(" "),a("h3",{attrs:{id:"dynamic-mapping"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dynamic-mapping"}},[t._v("#")]),t._v(" dynamic mapping")]),t._v(" "),a("p",[t._v("如果 "),a("code",[t._v("mapping")]),t._v(" 配置允许直接写入新字段，"),a("code",[t._v("es")]),t._v(" 会对新字段的类型进行推测并写入 "),a("code",[t._v("mapping")]),t._v("。推测是基于 "),a("code",[t._v("json")]),t._v(" 类型的：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("JSON 类型")]),t._v(" "),a("th",[t._v("Elasticsearch 类型")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("null")]),t._v(" "),a("td",[t._v("忽略")])]),t._v(" "),a("tr",[a("td",[t._v("boolean")]),t._v(" "),a("td",[t._v("boolean")])]),t._v(" "),a("tr",[a("td",[t._v("float")]),t._v(" "),a("td",[t._v("float")])]),t._v(" "),a("tr",[a("td",[t._v("integer")]),t._v(" "),a("td",[t._v("long")])]),t._v(" "),a("tr",[a("td",[t._v("object")]),t._v(" "),a("td",[t._v("object")])]),t._v(" "),a("tr",[a("td",[t._v("array")]),t._v(" "),a("td",[t._v("基于数组第一个非 "),a("code",[t._v("null")]),t._v(" 值的类型")])]),t._v(" "),a("tr",[a("td",[t._v("string")]),t._v(" "),a("td",[t._v("会对日期、浮点、整型做推断，否则设置为 "),a("code",[t._v("text")]),t._v(" 类型并包含 "),a("code",[t._v("keyword")]),t._v(" 子字段")])])])]),t._v(" "),a("h3",{attrs:{id:"dynamic-templates"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dynamic-templates"}},[t._v("#")]),t._v(" dynamic templates")]),t._v(" "),a("p",[t._v("通过定义 "),a("code",[t._v("dynamic templates")]),t._v(" 可以介入 "),a("code",[t._v("dynamic mapping")]),t._v(" 的映射逻辑，")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PUT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("test\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mappings"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dynamic_templates"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"string_as_keyword"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"match_mapping_type"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"string"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mapping"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"type"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"keyword"')]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("code",[t._v("match_mapping_type")]),t._v(" 参数对应推断出来的 "),a("code",[t._v("json")]),t._v(" 类型，当写入字段匹配到该类型，会自动转为配置的类型。")])])}),[],!1,null,null,null);s.default=e.exports}}]);