(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{231:function(s,a,t){"use strict";t.r(a);var e=t(0),v=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"平均负载"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#平均负载"}},[s._v("#")]),s._v(" 平均负载")]),s._v(" "),t("p",[s._v("平均负载是指单位时间内，系统处于"),t("strong",[s._v("可运行状态")]),s._v("和"),t("strong",[s._v("不可中断状态")]),s._v("的平均进程数，也就是"),t("strong",[s._v("平均活跃进程数")]),s._v("。")]),s._v(" "),t("h3",{attrs:{id:"uptime-命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#uptime-命令"}},[s._v("#")]),s._v(" uptime 命令")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("uptime")]),s._v("\n02:34:03 up "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" days, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":14,  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" user,  load average: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.63")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.83")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.88")]),s._v("\n")])])]),t("p",[s._v("使用 "),t("code",[s._v("uptime")]),s._v(" 命令可以查看过去1分钟、5分钟、15分钟的平均负载（"),t("code",[s._v("Load Average")]),s._v("）。")]),s._v(" "),t("h3",{attrs:{id:"查看-cpu-个数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看-cpu-个数"}},[s._v("#")]),s._v(" 查看 CPU 个数")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'model name'")]),s._v(" /proc/cpuinfo "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" -l\n")])])]),t("p",[s._v("如果平均负载大于 "),t("code",[s._v("CPU")]),s._v(" 个数，那么说明系统已经过载。")]),s._v(" "),t("h3",{attrs:{id:"平均负载与-cpu-使用率"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#平均负载与-cpu-使用率"}},[s._v("#")]),s._v(" 平均负载与 CPU 使用率")]),s._v(" "),t("p",[s._v("平均负载统计的不仅是正在使用 "),t("code",[s._v("CPU")]),s._v(" 的进程，还包括等待 "),t("code",[s._v("CPU")]),s._v(" 和等待 "),t("code",[s._v("I/O")]),s._v(" 的进程，对于 "),t("code",[s._v("CPU")]),s._v(" 密集型进程来说两者是一致的；对于 "),t("code",[s._v("I/O")]),s._v(" 密集型进程则不一定。")]),s._v(" "),t("h3",{attrs:{id:"cpu-使用率情况"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cpu-使用率情况"}},[s._v("#")]),s._v(" CPU 使用率情况")]),s._v(" "),t("p",[s._v("通过 "),t("code",[s._v("mpstat")]),s._v(" 命令查看  "),t("code",[s._v("%usr")]),s._v(" 和 "),t("code",[s._v("%iowait")]),s._v(" 列的 "),t("code",[s._v("CPU")]),s._v(" 使用率判断当前系统负载高是由 "),t("code",[s._v("CPU")]),s._v(" 运算还是 "),t("code",[s._v("iowait")]),s._v(" 引起的。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监控所有 CPU，间隔5秒输出一组数据")]),s._v("\nmpstat -P ALL "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n")])])]),t("p",[s._v("通过 "),t("code",[s._v("pidstat")]),s._v(" 命令查看导致 "),t("code",[s._v("CPU")]),s._v(" 使用率升高的进程。"),t("code",[s._v("%wait")]),s._v(" 显示进程等待 "),t("code",[s._v("CPU")]),s._v(" 的时间。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 间隔5秒后输出一组数据，-u表示CPU指标")]),s._v("\npidstat -u "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])])]),t("h2",{attrs:{id:"cpu-上下文"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cpu-上下文"}},[s._v("#")]),s._v(" CPU 上下文")]),s._v(" "),t("p",[t("code",[s._v("CPU")]),s._v(" 上下文指任务运行前依赖的寄存器和程序计数器。寄存器是 "),t("code",[s._v("CPU")]),s._v(" 内置的容量小、速度快的内存；程序计数器则是用来存储 "),t("code",[s._v("CPU")]),s._v(" 正在执行的指令位置，或者即将执行的下一条指令位置。")]),s._v(" "),t("h3",{attrs:{id:"cpu-上下文切换"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cpu-上下文切换"}},[s._v("#")]),s._v(" CPU 上下文切换")]),s._v(" "),t("p",[t("code",[s._v("CPU")]),s._v(" 上下文切换指的是将上一个任务的 "),t("code",[s._v("CPU")]),s._v(" 上下文保存起来，然后加载新任务的上下文。")]),s._v(" "),t("p",[s._v("过多的上下文切换，会把 "),t("code",[s._v("CPU")]),s._v(" 时间消耗在寄存器、内核栈以及虚拟内存等数据的保存和恢复上，从而缩短进程真正运行的时间，导致系统的整体性能大幅下降。")]),s._v(" "),t("p",[s._v("根据任务的不同，"),t("code",[s._v("CPU")]),s._v(" 的上下文切换就可以分为几个不同的场景，也就是"),t("strong",[s._v("进程上下文切换")]),s._v("、"),t("strong",[s._v("线程上下文切换")]),s._v("以及"),t("strong",[s._v("中断上下文切换")]),s._v("。")]),s._v(" "),t("h4",{attrs:{id:"进程上下文切换"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#进程上下文切换"}},[s._v("#")]),s._v(" 进程上下文切换")]),s._v(" "),t("p",[s._v("进程上下文切换会涉及寄存器、内核栈以及虚拟内存等数据的保存和恢复。")]),s._v(" "),t("ul",[t("li",[s._v("为了保证所有进程可以得到公平调度，CPU时间被划分为一段段的时间片，这些时间片再被轮流分配给各个进程。这样，当某个进程的时间片耗尽了，就会被系统挂起，切换到其它正在等待 CPU 的进程运行。")]),s._v(" "),t("li",[s._v("进程在系统资源不足（比如内存不足）时，要等到资源满足后才可以运行，这个时候进程也会被挂起，并由系统调度其他进程运行。")]),s._v(" "),t("li",[s._v("当进程通过睡眠函数 "),t("code",[s._v("sleep")]),s._v(" 这样的方法将自己主动挂起时，自然也会重新调度。")]),s._v(" "),t("li",[s._v("当有优先级更高的进程运行时，为了保证高优先级进程的运行，当前进程会被挂起，由高优先级进程来运行。")]),s._v(" "),t("li",[s._v("发生硬件中断时，CPU上的进程会被中断挂起，转而执行内核中的中断服务程序。")])]),s._v(" "),t("h4",{attrs:{id:"线程上下文切换"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#线程上下文切换"}},[s._v("#")]),s._v(" 线程上下文切换")]),s._v(" "),t("ul",[t("li",[s._v("当进程拥有多个线程时，这些线程会共享相同的虚拟内存和全局变量等资源，这些资源在上下文切换时是不需要修改的。")]),s._v(" "),t("li",[s._v("前后两个线程属于不同进程时，因为资源不共享，所以切换过程跟进程上下文切换是一样。")]),s._v(" "),t("li",[s._v("前后两个线程属于同一个进程时，因为虚拟内存是共享的，所以在切换时，虚拟内存这些资源就保持不动，只需要切换线程的私有数据、寄存器等不共享的数据。")])]),s._v(" "),t("h4",{attrs:{id:"中断上下文切换"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#中断上下文切换"}},[s._v("#")]),s._v(" 中断上下文切换")]),s._v(" "),t("p",[s._v("为了快速响应硬件事件，中断处理会打断进程的正常调度和执行，转而调用中断处理程序，响应设备事件。对于同一个 "),t("code",[s._v("CPU")]),s._v(" 来说，中断处理比进程拥有更高的优先级，所以中断上下文切换并不会与进程上下文切换同时发生。")]),s._v(" "),t("h3",{attrs:{id:"查看-cpu-上下文切换情况"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看-cpu-上下文切换情况"}},[s._v("#")]),s._v(" 查看 CPU 上下文切换情况")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看CPU上下文切换情况，间隔1秒输出1组数据")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vmstat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])])]),t("p",[t("code",[s._v("cs(context switch)")]),s._v(" 列显示每秒上下文切换次数、"),t("code",[s._v("in(interupt)")]),s._v(" 列显示每秒中断次数、"),t("code",[s._v("r(Running or Runnable)")]),s._v(" 是就绪队列的长度，即正在运行和等待 "),t("code",[s._v("CPU")]),s._v(" 的进程数、"),t("code",[s._v("b(blocked)")]),s._v(" 则是处于不可中断睡眠状态的进程数。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看进程上下文切换情况，间隔5秒输出1组数据")]),s._v("\npidstat -w "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n")])])]),t("p",[t("code",[s._v("cswch")]),s._v(" 列表示自愿上下文切换，即进程无法获取所需资源（"),t("code",[s._v("I/O")]),s._v("、内存等），导致的上下文切换。")]),s._v(" "),t("p",[t("code",[s._v("nvcswch")]),s._v(" 列表示非资源上下文切换，即时间片已到等原因被系统强制调度，进而发生上下文切换。")]),s._v(" "),t("h2",{attrs:{id:"定位-cpu-使用率过高"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#定位-cpu-使用率过高"}},[s._v("#")]),s._v(" 定位 CPU 使用率过高")]),s._v(" "),t("p",[s._v("使用 "),t("code",[s._v("top")]),s._v(" 命令查看当前各进程 "),t("code",[s._v("CPU")]),s._v("、内存等使用情况：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" - 04:15:22 up "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":51,  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" users,  load average: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.04")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.05")]),s._v("\nTasks: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("124")]),s._v(" total,   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" running, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v(" sleeping,   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" stopped,   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" zombie\n%Cpu"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.2")]),s._v(" us,  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v(" sy,  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" ni, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("99.5")]),s._v(" id,  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" wa,  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" hi,  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" si,  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" st\nKiB Mem "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7990124")]),s._v(" total,  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3514012")]),s._v(" free,  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3146764")]),s._v(" used,  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1329348")]),s._v(" buff/cache\nKiB Swap:  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5242876")]),s._v(" total,  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5242876")]),s._v(" free,        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" used.  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4554532")]),s._v(" avail Mem\n\n   PID "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11920")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4734688")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("997")]),s._v(".3m  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16744")]),s._v(" S   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.7")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12.8")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(":28.48 java\n")])])]),t("p",[s._v("功能键：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("1")]),s._v("：切换查看每个 "),t("code",[s._v("CPU")]),s._v(" 的指标。")]),s._v(" "),t("li",[t("code",[s._v("M")]),s._v("：按内存使用大小排序。")]),s._v(" "),t("li",[t("code",[s._v("P")]),s._v("：按 "),t("code",[s._v("CPU")]),s._v(" 使用率排序。")]),s._v(" "),t("li",[t("code",[s._v("H")]),s._v("：查询线程指标。")])]),s._v(" "),t("p",[s._v("定位到 "),t("code",[s._v("CPU")]),s._v(" 使用率高的线程后通过 "),t("code",[s._v("top -Hp pid")]),s._v(" 查看指定进程下的所有线程指标，找到使用率最高的线程，获取线程 "),t("code",[s._v("tid")]),s._v("。退出 "),t("code",[s._v("top")]),s._v("，使用 "),t("code",[s._v("printf %x\\n% tid")]),s._v(" 获取十六进制线程号并查看此线程的执行栈：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("jstack pid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" hex -A "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n")])])])])}),[],!1,null,null,null);a.default=v.exports}}]);