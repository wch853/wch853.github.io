(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{222:function(v,_,e){"use strict";e.r(_);var a=e(0),s=Object(a.a)({},(function(){var v=this,_=v.$createElement,e=v._self._c||_;return e("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[e("h1",{attrs:{id:"java面试（二）：redis"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#java面试（二）：redis"}},[v._v("#")]),v._v(" Java面试（二）：Redis")]),v._v(" "),e("h2",{attrs:{id:"redis"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#redis"}},[v._v("#")]),v._v(" Redis")]),v._v(" "),e("ul",[e("li",[v._v("数据类型丰富")]),v._v(" "),e("li",[v._v("支持数据磁盘持久化存储")]),v._v(" "),e("li",[v._v("支持主从")]),v._v(" "),e("li",[v._v("支持分片")])]),v._v(" "),e("h3",{attrs:{id:"为什么redis这么快"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#为什么redis这么快"}},[v._v("#")]),v._v(" 为什么Redis这么快")]),v._v(" "),e("ul",[e("li",[v._v("完全基于内存，绝大部分请求纯粹是内存操作，执行效率高")]),v._v(" "),e("li",[v._v("数据结构和对数据的操作简单")]),v._v(" "),e("li",[v._v("采用单线程，避免了频繁创建和销毁线程以及切换上下文带来的开销，没有锁竞争")]),v._v(" "),e("li",[v._v("使用 "),e("code",[v._v("I/O")]),v._v(" 多路复用模型")])]),v._v(" "),e("h3",{attrs:{id:"检索-key"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#检索-key"}},[v._v("#")]),v._v(" 检索 key")]),v._v(" "),e("p",[v._v("检索 "),e("code",[v._v("key")]),v._v(" 可以使用 "),e("code",[v._v("keys pattern")]),v._v(" 命令返回全部匹配的 "),e("code",[v._v("key")]),v._v("，但是数据量大时可能会阻塞其它操作。使用 "),e("code",[v._v("scan")]),v._v(" 命令可以实现分批检索 "),e("code",[v._v("key")]),v._v("：")]),v._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[v._v("SCAN cursor "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("[")]),v._v("MATCH pattern"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("]")]),v._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("[")]),v._v("COUNT count"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("]")]),v._v("\n")])])]),e("p",[v._v("初始命令给定一个起始 "),e("code",[v._v("cursor")]),v._v(" 用于指定数量地模糊匹配 "),e("code",[v._v("key")]),v._v("，如果在指定的 "),e("code",[v._v("count")]),v._v(" 内没有返回全部的匹配的 "),e("code",[v._v("key")]),v._v(" 则会返回一个游标用于下一次检索，直到返回的游标为0。")]),v._v(" "),e("h3",{attrs:{id:"redis-分布式锁"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#redis-分布式锁"}},[v._v("#")]),v._v(" Redis 分布式锁")]),v._v(" "),e("h4",{attrs:{id:"分布式锁需要解决的问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#分布式锁需要解决的问题"}},[v._v("#")]),v._v(" 分布式锁需要解决的问题")]),v._v(" "),e("ul",[e("li",[v._v("互斥性：任意时刻只能有一个客户端获取到锁")]),v._v(" "),e("li",[v._v("安全性：锁只能被持有锁的客户端删除")]),v._v(" "),e("li",[v._v("死锁：在某个客户端因为故障不能释放锁，需要采取措施避免死锁")]),v._v(" "),e("li",[v._v("容错：部分 "),e("code",[v._v("Redis")]),v._v(" 节点故障，客户端仍能获取到锁")])]),v._v(" "),e("h4",{attrs:{id:"redis-实现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#redis-实现"}},[v._v("#")]),v._v(" Redis 实现")]),v._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[v._v("SET key value "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("[")]),v._v("EX seconds"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("]")]),v._v(" NX\n")])])]),e("p",[e("code",[v._v("NX")]),v._v(" 指令表示指定 "),e("code",[v._v("key")]),v._v(" 不存在才进行操作，否则返回 "),e("code",[v._v("nil")]),v._v("。多个客户端可以通过设置相同的 "),e("code",[v._v("key")]),v._v(" 值来获取分布式锁，为了避免死锁，需要设置过期时间。")]),v._v(" "),e("h3",{attrs:{id:"redis-持久化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#redis-持久化"}},[v._v("#")]),v._v(" Redis 持久化")]),v._v(" "),e("h4",{attrs:{id:"rdb（快照）持久化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#rdb（快照）持久化"}},[v._v("#")]),v._v(" RDB（快照）持久化")]),v._v(" "),e("p",[e("code",[v._v("RDB")]),v._v(" 通过保存某个时间点的全量数据快照来进行持久化，数据量大时会由于 "),e("code",[v._v("I/O")]),v._v(" 而严重影响性能，最近一次快照后的数据有可能会丢失，但是恢复数据的速度快。")]),v._v(" "),e("ul",[e("li",[e("code",[v._v("SAVE")]),v._v("：阻塞 "),e("code",[v._v("Redis")]),v._v(" 主进程，直到 "),e("code",[v._v("RDB")]),v._v(" 文件创建完成，这种方式会阻塞所有客户端请求。")]),v._v(" "),e("li",[e("code",[v._v("BGSAVE")]),v._v("："),e("code",[v._v("Fork")]),v._v(" 出一个子进程来创建 "),e("code",[v._v("RDB")]),v._v(" 文件，不会阻塞客户端请求。")])]),v._v(" "),e("h4",{attrs:{id:"aof（append-only-file）持久化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#aof（append-only-file）持久化"}},[v._v("#")]),v._v(" AOF（Append-Only-File）持久化")]),v._v(" "),e("p",[e("code",[v._v("AOF")]),v._v(" 持久化通过记录除查询以外的所有变更指令来实现持久化，变更命令会通过文件追加的方式增量写入 "),e("code",[v._v("AOF")]),v._v(" 文件。"),e("code",[v._v("AOF")]),v._v(" 文件会因不断写入命令不断增大，"),e("code",[v._v("Redis")]),v._v(" 会重写日志文件，即根据已有的数据内容生成新的 "),e("code",[v._v("AOF")]),v._v(" 文件，替换原来的文件。"),e("code",[v._v("AOF")]),v._v(" 持久化的方式适合保存增量数据，数据不易丢失，但是文件体积大，恢复时间长。")]),v._v(" "),e("h4",{attrs:{id:"rdb-aof-混合持久化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#rdb-aof-混合持久化"}},[v._v("#")]),v._v(" RDB-AOF 混合持久化")]),v._v(" "),e("p",[v._v("通过 "),e("code",[v._v("BGSAVE")]),v._v(" 做全量持久化，"),e("code",[v._v("AOF")]),v._v(" 做增量持久化。")]),v._v(" "),e("h3",{attrs:{id:"redis-主从同步"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#redis-主从同步"}},[v._v("#")]),v._v(" Redis 主从同步")]),v._v(" "),e("h4",{attrs:{id:"全同步"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#全同步"}},[v._v("#")]),v._v(" 全同步")]),v._v(" "),e("ul",[e("li",[v._v("从节点发送同步请求给主节点")]),v._v(" "),e("li",[v._v("主节点执行 "),e("code",[v._v("BGSAVE")]),v._v("，保存全量数据快照，并在快照生成期间将增量变更命令缓存起来")]),v._v(" "),e("li",[v._v("主节点保存全量数据快照完成后将文件发送给从节点")]),v._v(" "),e("li",[v._v("从节点保存快照文件并加载到内存中")]),v._v(" "),e("li",[v._v("主节点将增量变更发送给从节点")])]),v._v(" "),e("h3",{attrs:{id:"redis-sentinel"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#redis-sentinel"}},[v._v("#")]),v._v(" Redis Sentinel")]),v._v(" "),e("p",[e("code",[v._v("Redis Sentinel（哨兵）")]),v._v(" 用于解决主节点宕机后的主从切换问题。")]),v._v(" "),e("ul",[e("li",[v._v("监控：检查主从服务器是否正常运行")]),v._v(" "),e("li",[v._v("提醒：通过 "),e("code",[v._v("API")]),v._v(" 向管理员或其它应用程序发送故障通知")]),v._v(" "),e("li",[v._v("自动故障迁移：主从切换")])]),v._v(" "),e("h3",{attrs:{id:"redis-集群"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#redis-集群"}},[v._v("#")]),v._v(" Redis 集群")]),v._v(" "),e("p",[v._v("对 "),e("code",[v._v("key")]),v._v(" 做一致性 "),e("code",[v._v("hash")])])])}),[],!1,null,null,null);_.default=s.exports}}]);