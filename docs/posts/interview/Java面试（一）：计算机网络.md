# Java面试（一）：计算机网络

## OSI 七层模型

![OSI七层模型](/img/interview/OSI七层模型.jpg)

- 物理层：定义了数据传输介质的特性，用以建立、维护和拆除物理链路。
- 数据链路层：定义了如何对物理介质进行访问、将 `IP` 数据报封装成帧或从帧中提取有效数据，上交网络层，并对帧进行差错检测。
- 网络层：为不同主机提供通信服务，将运输层产生的报文封装为 `IP` 数据报，进行传送。同时负责选择合适的路由，决定如何将数据从发送方路由到接收方。
- 传输层：为主机间进程的通信提供通用的数据传输服务。
- 会话层：允许不同机器上的用户建立和管理会话关系
- 表示层：协商通信双方的通信语法，使得传输的数据在双方的解释一致。
- 应用层：为应用程序提供通过 `OSI` 环境进行通信的接口。

## TCP/IP 四层模型

`OSI` 模型过于复杂和庞大，实际广泛应用的是参考了 `OSI` 模型的 `TCP/IP` 四层模型。

| OSI        | TCP/IP | 网络协议                                 |
| ---------- | ------ | ---------------------------------------- |
| 应用层     | 应用层 | HTTP、TFTP、SNMP、FTP、SMTP、DNS、Telnet |
| 表示层     |        |                                          |
| 会话层     |        |                                          |
| 传输层     | 传输层 | TCP、UDP                                 |
| 网络层     | 网际层 | IP、ICMP、ARP、IGMP                      |
| 数据链路层 | 链路层 | Ethernet、PPP                            |
| 物理层     |        |                                          |

## TCP 协议

- 面向连接、可靠的、基于字节流的传输层通信协议
- 将应用层数据分割成报文段并交给网络层传输给目标节点的 `TCP` 层
- 数据报有序号，接收方接收成功则发送 `ACK` 确认，否则重传
- 使用奇偶校验和函数检验数据在传输过程中是否有差错

### TCP 三次握手

三次握手用于创建 `TCP` 连接。

![TCP三次握手](/img/interview/TCP三次握手.png)

- 第一次握手：建立连接时，客户端发送 `SYN(syn=x)` 包到服务器，并进入 `SYN_SEND` 状态，等待服务器确认。
- 第二次握手：服务器收到 `SYN` 包，需要向客户端发送 `ACK(ack=x+1)` 进行确认，同时也发送一个 `SYN(syn=y)` 包，并进入 `SYN_RECV` 状态。
- 第三次握手：客户端收到服务器的 `SYN` 和 `ACK` 包，向服务器发生 `ACK(ack=y+1)` 确认包，发送完成后，双方进入 `ESTABLISHED` 状态，完成三次握手。

### TCP 四次挥手

数据传输完毕后，可以通过四次挥手来关闭 `TCP` 连接。

- 第一次挥手：客户端向服务器发生一个 `FIN`，用来关闭客户端到服务器的数据传送，客户端进入 `FIN_WAIT_1` 状态。
- 第二次挥手：服务器收到 `FIN` 后，发生一个 `ACK` 给客户端，服务器进入 `CLOSE_WAIT` 状态。
- 第三次挥手：服务发送一个 `FIN`，用来关闭服务器到客户端的数据传送，服务器进入 `LAST_ACK` 状态。
- 第四次挥手：客户端收到 `FIN` 后，进入 `TIME_WAIT` 状态，接着发送一个 `ACK` 给服务器，服务器收到后进入 `CLOSED` 状态，完成四次挥手。

## UDP

- 面向非连接
- 不维护连接，支持向多个客户端传输相同的消息
- 数据包报头只有8个字节，额外开销小
- 尽最大努力交付，不保证可靠交付
- 面向报文，不对应用程序提交的报文进行拆分或合并

## HTTP

### GET 和 POST 请求

- `GET` 请求的参数在 `URL` 中且有长度限制，`POST` 请求参数在报文 `body` 中。
- `GET` 请求符合幂等性和安全性，`POST` 请求不符合。
- `GET` 请求可以被缓存，`POST` 请求不可以。

### Cookie

 `Cookie` 是由服务器发给客户端的特殊信息（用户相关信息），以文本的形式存放在客户端，当客户端向服务器再次发送请求会在请求头中加入 `Cookie`。服务器收到 `Cookie` 后会进行解析。

### Session

`Session` 是服务器维护的与客户端的连接会话。由于存储在服务器上，相对于 `Cookie` 安全性更高。

### HTTPS

#### SSL

`HTTPS` 相对于 `HTTP` 使用了 `SSL(TLS)` 作为为网络通信提供安全及数据完整性的安全协议。`SSL` 采用身份验证和数据加密来保证网络通信安全的数据的完整性。

#### HTTPS 数据传输流程

- 浏览器将支持的加密算法发送给服务器
- 服务器选择一套浏览器支持的加密算法，以证书的形式回发给浏览器
- 浏览器验证证书合法性，如果合法，则结合证书公钥将客户端随机生成的对称密钥加密发送给服务器
- 服务器使用私钥解密对称秘钥，此后浏览器和服务器使用对称密钥进行加密通信。

## Socket

`Socket` 是对 `TCP/IP` 协议的抽象，是操作系统对外开放的接口。

